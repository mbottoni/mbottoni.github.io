
<!DOCTYPE html>
<html lang='en-US'>
<head>
  <meta charset='utf-8'>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Understanding and Implementing RAG (Retrieval-Augmented Generation)</title>
  <meta name="description" content="Retrieval-Augmented Generation (RAG) is a powerful technique that combines the strengths of large language 
models with the ability to retrieve relevant information from external sources. This approach enhances the 
model's responses by grounding them in specific, up-to-date, or domain-specific knowledge.">
  <link rel="icon" href="/favicon.png" type="image/png">
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="canonical" href="https://mbottoni.github.io/2024/08/27/rag.html">
  <link rel="alternate" type="application/rss+xml" title="mbottoni" href="https://mbottoni.github.io/feed.xml">
  <style>
  @font-face {
    font-family: 'Open Sans'; src: url('/css/OpenSans-300-Normal.woff2') format('woff2');
    font-weight: 300; font-style: normal;
  }
  @font-face {
    font-family: 'JetBrains Mono'; src: url('/css/JetBrainsMono-400-Normal.woff2') format('woff2');
    font-weight: 400; font-style: normal;
  }
  @font-face {
    font-family: 'JetBrains Mono'; src: url('/css/JetBrainsMono-700-Normal.woff2') format('woff2');
    font-weight: 700; font-style: normal;
  }
  @font-face {
    font-family: 'EB Garamond'; src: url('/css/EBGaramond-400-Normal.woff2') format('woff2');
    font-weight: 400; font-style: normal;
  }
  @font-face {
    font-family: 'EB Garamond'; src: url('/css/EBGaramond-400-Italic.woff2') format('woff2');
    font-weight: 400; font-style: italic;
  }
  @font-face {
    font-family: 'EB Garamond'; src: url('/css/EBGaramond-700-Normal.woff2') format('woff2');
    font-weight: 700; font-style: normal;
  }
  @font-face {
    font-family: 'EB Garamond'; src: url('/css/EBGaramond-700-Italic.woff2') format('woff2');
    font-weight: 700; font-style: italic;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; margin-block-start: 0; margin-block-end: 0; }

  body {
    max-width: 80ch;
    padding: 2ch;
    margin-left: auto;
    margin-right: auto;
  }

  header { margin-bottom: 2rem; }
  header > nav { display: flex; column-gap: 2ch; align-items: baseline; flex-wrap: wrap; }
  header a { font-style: normal; color: rgba(0, 0, 0, .8); text-decoration: none; }
  header a:hover { color: rgba(0, 0, 0, .8); text-decoration: underline; }
  header .title { font-size: 1.25em; flex-grow: 2; }

  footer { margin-top: 2rem; }
  footer > p { display: flex; column-gap: 2ch; justify-content: center; flex-wrap: wrap; }
  footer a { color: rgba(0, 0, 0, .8); text-decoration: none; white-space: nowrap; }
  footer i { vertical-align: middle; color: rgba(0, 0, 0, .8) }

  .theme-grid { display: grid; gap: 2rem; grid-template-columns: repeat(auto-fit, minmax(16rem, 1fr)); }
  .theme-card { border: 1px solid rgba(0,0,0,.12); border-radius: 1rem; padding: 1.5rem; display: flex; flex-direction: column; gap: .75rem; }
  .theme-card h2 { font-size: 1.35em; }
  .theme-card h2 a { text-decoration: none; color: #b32f1c; }
  .theme-card h2 a:hover { text-decoration: underline; }
  .theme-card p { color: rgba(0,0,0,.75); line-height: 1.5; }
  .theme-meta { font-size: .85em; color: rgba(0,0,0,.6); }

  .theme-page header h1 { font-size: 2em; margin-bottom: .5rem; }
  .theme-page header p { color: rgba(0,0,0,.65); line-height: 1.5; }
  .theme-page { display: flex; flex-direction: column; gap: 1.5rem; }

  .post-list { list-style: none; display: flex; flex-direction: column; gap: 1.5rem; padding: 0; }
  .post-card { display: grid; gap: 1rem; grid-template-columns: minmax(0, 1fr); }
  .post-card__media { display: none; }
  .post-card__body h3 { font-size: 1.1em; margin-bottom: .35rem; }
  .post-card__body p { color: rgba(0, 0, 0, .7); }
  .post-card__media a { display: block; border-radius: .75rem; overflow: hidden; }
  .post-card__media img { width: 100%; height: 100%; object-fit: cover; display: block; }
  @media (min-width: 720px) {
    .post-card { grid-template-columns: 260px 1fr; align-items: center; }
    .post-card__media { display: block; min-height: 160px; }
    .post-card__media:empty { display: block; }
  }

  .theme-pill, .theme-banner a { display: inline-flex; align-items: center; gap: .4rem; font-size: .8em; text-transform: uppercase; letter-spacing: .08em; border: 1px solid rgba(0, 0, 0, .15); border-radius: 999px; padding: .25rem .9rem; text-decoration: none; color: rgba(0, 0, 0, .7); }
  .theme-pill svg, .theme-banner svg { width: .75em; height: .75em; }
  .theme-banner { margin-bottom: 1rem; }
  .theme-banner span { font-size: .8em; color: rgba(0, 0, 0, .6); margin-right: .5rem; }
  
  .katex { font-size: 0.95em !important; color: rgba(0, 0, 0, 0.9); }
  .katex-display { margin: 0.5em 0; overflow-x: auto; overflow-y: hidden; }

  </style>

  <link rel="stylesheet" href="/css/main.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
</head>

<body>
  <header>
    <nav>
      <a class="title" href="/">mbottoni</a>
      <a href="/about.html">About</a>
      <a href="/resume.html">Resume</a>
      <a href="/repositories.html">Repositories</a>
      <a href="/links.html">Links</a>
    </nav>
  </header>

  <main>
  
      <div class="theme-banner">
        <span>Filed under</span>
        <a class="theme-pill" href="/themes/frontier.html">
          Frontier LLMs &amp; Architectures
        </a>
      </div>
      <article >

    <h1>
    <a href="#Understanding-and-Implementing-RAG-Retrieval-Augmented-Generation"><span>Understanding and Implementing RAG (Retrieval-Augmented Generation)</span> <time datetime="2024-08-27">Aug 27, 2024</time></a>
    </h1>

<figure>

<img alt="" src="/assets/frontier/rag.png">
</figure>
<p><span>Retrieval-Augmented Generation (RAG) is a powerful technique that combines the strengths of large language </span>
<span>models with the ability to retrieve relevant information from external sources. This approach enhances the </span>
<span>model</span>&rsquo;<span>s responses by grounding them in specific, up-to-date, or domain-specific knowledge.</span></p>
<p><span>RAG works by first retrieving relevant information from a knowledge base and then using that information to </span>
<span>generate a response. This process involves three main steps:</span></p>
<ol>
<li>
<strong><strong><span>Retrieval</span></strong></strong><span>: The system searches for relevant information in a database or document collection.</span>
</li>
<li>
<strong><strong><span>Augmentation</span></strong></strong><span>: The retrieved information is combined with the user</span>&rsquo;<span>s query.</span>
</li>
<li>
<strong><strong><span>Generation</span></strong></strong><span>: A language model uses the augmented input to generate a response.</span>
</li>
</ol>
<section id="Implementing-RAG-with-LangChain">

    <h2>
    <a href="#Implementing-RAG-with-LangChain"><span>Implementing RAG with LangChain</span> </a>
    </h2>
<p><span>Let</span>&rsquo;<span>s look at a simple implementation of RAG using LangChain. This code </span>
<span>is not ready for production use, but it is a good starting point for understanding RAG.</span></p>

<figure class="code-block">


<pre><code><span class="line"><span class="hl-keyword">from</span> langchain <span class="hl-keyword">import</span> OpenAI</span>
<span class="line"><span class="hl-keyword">from</span> langchain.embeddings <span class="hl-keyword">import</span> OpenAIEmbeddings</span>
<span class="line"><span class="hl-keyword">from</span> langchain.vectorstores <span class="hl-keyword">import</span> Chroma</span>
<span class="line"><span class="hl-keyword">from</span> langchain.text_splitter <span class="hl-keyword">import</span> CharacterTextSplitter</span>
<span class="line"><span class="hl-keyword">from</span> langchain.chains <span class="hl-keyword">import</span> RetrievalQA</span>
<span class="line"><span class="hl-keyword">from</span> langchain.document_loaders <span class="hl-keyword">import</span> TextLoader</span>
<span class="line"></span>
<span class="line"><span class="hl-comment"># Load and prepare the document</span></span>
<span class="line">loader = TextLoader(<span class="hl-string">&quot;path_to_your_document.txt&quot;</span>)</span>
<span class="line">documents = loader.load()</span>
<span class="line"></span>
<span class="line"><span class="hl-comment"># Split the document into chunks</span></span>
<span class="line">text_splitter = CharacterTextSplitter(chunk_size=<span class="hl-number">1000</span>, chunk_overlap=<span class="hl-number">0</span>)</span>
<span class="line">texts = text_splitter.split_documents(documents)</span>
<span class="line"></span>
<span class="line"><span class="hl-comment"># Create embeddings and store them</span></span>
<span class="line">embeddings = OpenAIEmbeddings()</span>
<span class="line">vectorstore = Chroma.from_documents(texts, embeddings)</span>
<span class="line"></span>
<span class="line"><span class="hl-comment"># Create a retriever</span></span>
<span class="line">retriever = vectorstore.as_retriever()</span>
<span class="line"></span>
<span class="line"><span class="hl-comment"># Initialize the language model</span></span>
<span class="line">llm = OpenAI()</span>
<span class="line"></span>
<span class="line"><span class="hl-comment"># Create the RAG chain</span></span>
<span class="line">qa_chain = RetrievalQA.from_chain_type(</span>
<span class="line">    llm=llm,</span>
<span class="line">    chain_type=<span class="hl-string">&quot;stuff&quot;</span>,</span>
<span class="line">    retriever=retriever</span>
<span class="line">)</span>
<span class="line"></span>
<span class="line"><span class="hl-comment"># Use the RAG system</span></span>
<span class="line">query = <span class="hl-string">&quot;What is the main topic of the document?&quot;</span></span>
<span class="line">response = qa_chain.run(query)</span>
<span class="line"><span class="hl-built_in">print</span>(response)</span></code></pre>

</figure>
<p><span>Here are the steps we took:</span></p>
<ol>
<li>
<span>We load a document and split it into smaller chunks.</span>
</li>
<li>
<span>We create embeddings for these chunks and store them in a vector database (Chroma).</span>
</li>
<li>
<span>We set up a retriever to fetch relevant information from the vector store.</span>
</li>
<li>
<span>We initialize a language model (OpenAI</span>&rsquo;<span>s GPT in this case).</span>
</li>
<li>
<span>We create a RetrievalQA chain that combines the retriever and the language model.</span>
</li>
<li>
<span>Finally, we can use this chain to answer questions based on the content of our document.</span>
</li>
</ol>
</section>
</article>
    
  </main>

  <footer class="site-footer">
    <p>
      <a href="https://github.com/mbottoni/mbottoni.github.io/edit/master/content/posts/2024-08-27-rag.dj">
        <svg class="icon"><use href="/assets/icons.svg#edit"/></svg>
        Fix typo
      </a>
      <a href="/feed.xml">
        <svg class="icon"><use href="/assets/icons.svg#rss"/></svg>
        Subscribe
      </a>
      <a href="mailto:maruanbakriottoni@gmail.com">
        <svg class="icon"><use href="/assets/icons.svg#email"/></svg>
        Get in touch
      </a>
      <a href="https://github.com/mbottoni">
        <svg class="icon"><use href="/assets/icons.svg#github"/></svg>
        mbottoni
      </a>
    </p>
  </footer>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"></script>
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
  </script>
  <script>
    function unwrapPlainSpans(root) {
      for (const span of root.querySelectorAll("span")) {
        if (!(span instanceof HTMLElement)) continue;
        if (span.attributes.length === 0 && span.childElementCount === 0) {
          span.replaceWith(document.createTextNode(span.textContent || ""));
        }
      }
      root.normalize();
    }

    function addCopyButtons() {
      document.querySelectorAll('figure.code-block').forEach(block => {
        if (block.querySelector('.copy-button')) return;
        const button = document.createElement('button');
        button.className = 'copy-button';
        button.textContent = 'Copy';
        button.addEventListener('click', () => {
          const code = block.querySelector('code')?.innerText || '';
          navigator.clipboard.writeText(code).then(() => {
            button.textContent = 'Copied!';
            setTimeout(() => button.textContent = 'Copy', 2000);
          });
        });
        block.appendChild(button);
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      unwrapPlainSpans(document.body);
      addCopyButtons();
      let attempts = 0;
      const maxAttempts = 40;
      const renderMath = () => {
        if (typeof renderMathInElement === "function") {
          renderMathInElement(document.body, {
            delimiters: [
              { left: "$$", right: "$$", display: true },
              { left: "$", right: "$", display: false },
              { left: "\(", right: "\)", display: false },
              { left: "\[", right: "\]", display: true },
            ],
            throwOnError: false,
          });
        } else if (attempts < maxAttempts) {
          attempts += 1;
          setTimeout(renderMath, 75);
        }
      };
      renderMath();
    });
  </script>
</body>

</html>
